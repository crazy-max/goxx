#!/usr/bin/env bash

set -e

source goxx-env

if [ -n "$GOARCH" ]; then
  export GOARCH=$GOARCH
fi
if [ -n "$GOOS" ]; then
  export GOOS=$GOOS
fi
if [ -n "$GOARM" ]; then
  export GOARM=$GOARM
fi
if [ -n "$GOMIPS" ]; then
  export GOMIPS=$GOMIPS
fi
if [ -n "$GOMIPS64" ]; then
  export GOMIPS64=$GOMIPS64
fi
if [ -n "$GOBIN" ]; then
  export GOBIN=$GOBIN
fi

if command -v "$AR" >/dev/null 2>/dev/null; then
  export AR=$AR
fi
if command -v "$CC" >/dev/null 2>/dev/null; then
  export CC=$CC
  export CGO_CFLAGS=$CGO_CFLAGS
fi
if command -v "$CXX" >/dev/null 2>/dev/null; then
  export CXX=$CXX
  export CGO_CXXFLAGS=$CGO_CXXFLAGS
fi

if [ -z "$GOBIN" ] && [ -n "$GOPATH" ] && [ -n "$GOARCH" ] && [ -n "$GOOS" ]; then
  export PATH=${GOPATH}/bin/${GOOS}_${GOARCH}:${PATH}
fi

exec go "$@"
